"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const asn1_1 = require("asn1");
const EntryChangeNotificationControl_1 = require("./controls/EntryChangeNotificationControl");
const PagedResultsControl_1 = require("./controls/PagedResultsControl");
const PersistentSearchControl_1 = require("./controls/PersistentSearchControl");
const ServerSideSortingRequestControl_1 = require("./controls/ServerSideSortingRequestControl");
class ControlParser {
    static parse(reader) {
        if (reader.readSequence() === null) {
            return null;
        }
        let type = '';
        let critical = false;
        let value = Buffer.alloc(0);
        if (reader.length) {
            const end = reader.offset + reader.length;
            type = reader.readString();
            if (reader.offset < end) {
                if (reader.peek() === asn1_1.Ber.Boolean) {
                    critical = reader.readBoolean();
                }
            }
            if (reader.offset < end) {
                value = reader.readString(asn1_1.Ber.OctetString, true);
            }
        }
        let control;
        switch (type) {
            case EntryChangeNotificationControl_1.EntryChangeNotificationControl.type:
                control = new EntryChangeNotificationControl_1.EntryChangeNotificationControl({
                    critical,
                });
                break;
            case PagedResultsControl_1.PagedResultsControl.type:
                control = new PagedResultsControl_1.PagedResultsControl({
                    critical,
                });
                break;
            case PersistentSearchControl_1.PersistentSearchControl.type:
                control = new PersistentSearchControl_1.PersistentSearchControl({
                    critical,
                });
                break;
            case ServerSideSortingRequestControl_1.ServerSideSortingRequestControl.type:
                control = new ServerSideSortingRequestControl_1.ServerSideSortingRequestControl({
                    critical,
                });
                break;
            default:
                return null;
        }
        const controlReader = new asn1_1.BerReader(value);
        control.parse(controlReader);
        return control;
    }
}
exports.ControlParser = ControlParser;
//# sourceMappingURL=ControlParser.js.map